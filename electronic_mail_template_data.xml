<?xml version="1.0"?>
<!-- This file is part pyme module for Tryton.
The COPYRIGHT file at the top level of this repository contains the full copyright notices and license terms. -->
<tryton>
    <data noupdate="1" skiptest="1">
        <!-- Mailbox -->
        <record model="electronic.mail.mailbox" id="electronic_mail_mailbox_send">
            <field name="name">Enviado</field>
        </record>
        <record model="electronic.mail.mailbox" id="electronic_mail_mailbox_draft">
            <field name="name">Borrador</field>
        </record>
        <record model="electronic.mail.mailbox" id="electronic_mail_mailbox_error">
            <field name="name">Error</field>
        </record>
        <record model="electronic.mail.mailbox" id="electronic_mail_mailbox_outbox">
            <field name="name">Salida</field>
        </record>

        <!-- Electroni Mail Template -->
        <!-- Party -->
        <record model="electronic.mail.template" id="party_email_template">
            <field name="name">Tercero</field>
            <field name="from_">user@demo_server.com</field>
            <field name="to">${','.join([x.email for x in record.addresses if x.email]) or record.get_mechanism('email') or ''}</field>
            <field name="subject">${record.name}</field>
            <field name="model" search="[('model', '=', 'party.party')]"/>
            <field name="language">${record.lang and record.lang.code or 'es_ES'}</field>
            <field name="plain">${record.name}

Estimado Sr./Sra.

Atentamente,</field>
            <field name="html">&lt;h2&gt;${record.name}&lt;/h2&gt;

&lt;p&gt;Estimado Sr./Sra.&lt;/p&gt;

&lt;p&gt;Atentamente,&lt;/p&gt;</field>
            <field name="engine">genshi</field>
            <field name="signature" eval="True"/>
        </record>

        <record model="electronic.mail.template" id="party_pending_payments_email_template">
            <field name="name">Pagos pendientes</field>
            <field name="from_">user@demo_server.com</field>
            <field name="to">${','.join([x.email for x in record.addresses if x.email]) or record.get_mechanism('email') or ''}</field>
            <field name="subject">Pagos pendientes de ${record.name}</field>
            <field name="model" search="[('model', '=', 'party.party')]"/>
            <field name="language">${record.lang and record.lang.code or 'es_ES'}</field>
            <field name="plain">Buenos días ${record.name},

Esta es la relación de pagos pendientes de ${record.name}:

Fecha       Importe  Documento Descripción
#for line in record.receivable_lines
${str(line.maturity_date)[8:]}-${str(line.maturity_date)[5:7]}-${str(line.maturity_date)[:4]} ${' '*(8-len(str(line.debit-line.credit)))} ${line.debit-line.credit}€  ${line.origin and line.origin.rec_name or ''} ${line.description}
#end
#for line in record.payable_lines
${str(line.maturity_date)[8:]}-${str(line.maturity_date)[5:7]}-${str(line.maturity_date)[:4]} ${' '*(8-len(str(line.debit-line.credit)))} ${line.debit-line.credit}€  ${line.origin and line.origin.rec_name or ''} ${line.description}
#end

La deuda total es de ${record.receivable-record.payable}€
La deuda total ya vencida es de ${record.receivable_today-record.payable_today}€

Les agradeceríamos que comprobaran esta información con su departamento de contabilidad y que realizaran los pagos pendientes lo más pronto posible. 

Atentamente,</field>
            <field name="html">&lt;p&gt;Buenos días ${record.name},&lt;/p&gt;

&lt;p&gt;Esta es la relación de pagos pendientes de ${record.name}:&lt;/p&gt;

&lt;table cellpadding="5"&gt;
&lt;tr&gt;&lt;td&gt;Fecha&lt;/td&gt;&lt;td&gt;Importe&lt;/td&gt;&lt;td&gt;Documento&lt;/td&gt;&lt;td&gt;Descripción&lt;/td&gt;&lt;/tr&gt;
#for line in record.receivable_lines
&lt;tr&gt;&lt;td&gt;${str(line.maturity_date)[8:]}-${str(line.maturity_date)[5:7]}-${str(line.maturity_date)[:4]} ${' '*(8-len(str(line.debit-line.credit)))}&lt;/td&gt;&lt;td align="right"&gt;${line.debit-line.credit}€&lt;/td&gt;&lt;td&gt;${line.origin and line.origin.rec_name or ''}&lt;/td&gt;&lt;td&gt;${line.description}&lt;/td&gt;&lt;/tr&gt;
#end
#for line in record.payable_lines
&lt;tr&gt;&lt;td&gt;${str(line.maturity_date)[8:]}-${str(line.maturity_date)[5:7]}-${str(line.maturity_date)[:4]} ${' '*(8-len(str(line.debit-line.credit)))}&lt;/td&gt;&lt;td align="right"&gt;${line.debit-line.credit}€&lt;/td&gt;&lt;td&gt;${line.origin and line.origin.rec_name or ''}&lt;/td&gt;&lt;td&gt;${line.description}&lt;/td&gt;&lt;/tr&gt;
#end
&lt;/table&gt;

&lt;p&gt;La deuda total es de ${record.receivable-record.payable}€&lt;/p&gt;

&lt;p&gt;La deuda total ya vencida es de ${record.receivable_today-record.payable_today}€&lt;/p&gt;

&lt;p&gt;Les agradeceríamos que comprobaran esta información con su departamento de contabilidad y que realizaran los pagos pendientes lo más pronto posible. &lt;/p&gt;

&lt;p&gt;Atentamente,&lt;/p&gt;</field>
            <field name="engine">genshi</field>
            <field name="signature" eval="True"/>
        </record>

        <!-- Contact / address -->
        <record model="electronic.mail.template" id="contact_email_template">
            <field name="name">Contacto</field>
            <field name="from_">user@demo_server.com</field>
            <field name="to">${record.email or record.party.get_mechanism('email') or ''}</field>
            <field name="subject">Subject ${record.name}</field>
            <field name="model" search="[('model', '=', 'party.address')]"/>
            <field name="language">${record.party.lang and record.party.lang.code or 'es_ES'}</field>
            <field name="plain">${record.name}

Estimado Sr./Sra.

Atentamente,</field>
            <field name="html">&lt;h2&gt;${record.name}&lt;/h2&gt;

&lt;p&gt;Estimado Sr./Sra.&lt;/p&gt;

&lt;p&gt;Atentamente,&lt;/p&gt;</field>
            <field name="engine">genshi</field>
            <field name="signature" eval="True"/>
        </record>

        <!-- Invoice -->
        <record model="electronic.mail.template" id="invoice_email_template">
            <field name="name">Factura</field>
            <field name="from_">user@demo_server.com</field>
            <field name="to">${record.invoice_address.email or record.party.get_mechanism('email') or ''}</field>
            <field name="subject">${record.state in ['draft','proforma'] and 'Presupuesto' or 'Factura'} ${record.number or record.party.name}</field>
            <field name="model" search="[('model', '=', 'account.invoice')]"/>
            <field name="language">${record.party.lang and record.party.lang.code or 'es_ES'}</field>
            <field name="plain">Estimado Sr./Sra. ${record.invoice_address.name or ''},

#if record.state == 'draft'
Adjuntamos el presupuesto que ha solicitado.
#end
#if record.state == 'proforma'
Adjuntamos la factura ProForma ${record.description or ''}.
#end
#if record.state not in ['draft', 'proforma']
Adjuntamos la factura con fecha ${str(record.invoice_date)[8:]}-${str(record.invoice_date)[5:7]}-${str(record.invoice_date)[:4]} y número ${record.number}.
#end

El documento está en formato PDF. Para poder leerlo correctamente es necesario haber instalado un programa lector de PDFs (Adobe Acrobat Reader o similar) en su ordenador.

Si desea alguna aclaración adicional puede contactar mediante la dirección de correo ${record.company.party.get_mechanism('email') or 'user@demo_server.com'}.

Atentamente,</field>
            <field name="html">&lt;p&gt;Estimado Sr./Sra. ${record.invoice_address.name or ''},&lt;/p&gt;

#if record.state == 'draft'
&lt;p&gt;Adjuntamos el presupuesto que ha solicitado.&lt;/p&gt;
#end
#if record.state == 'proforma'
&lt;p&gt;Adjuntamos la factura ProForma ${record.description or ''}.&lt;/p&gt;
#end
#if record.state not in ['draft', 'proforma']
&lt;p&gt;Adjuntamos la factura con fecha ${str(record.invoice_date)[8:]}-${str(record.invoice_date)[5:7]}-${str(record.invoice_date)[:4]} y número ${record.number}.&lt;/p&gt;
#end

&lt;p&gt;El documento está en formato PDF. Para poder leerlo correctamente es necesario haber instalado un programa lector de PDFs (Adobe Acrobat Reader o similar) en su ordenador.&lt;/p&gt;

&lt;p&gt;Si desea alguna aclaración adicional puede contactar mediante la dirección de correo ${record.company.party.get_mechanism('email') or 'user@demo_server.com'}.&lt;/p&gt;

&lt;p&gt;Atentamente,&lt;/p&gt;</field>
            <field name="engine">genshi</field>
            <field name="signature" eval="True"/>
        </record>
    </data>
    <record model="electronic.mail.template.ir.action.report" id="invoice_email_template_report">
        <field name="template" ref="invoice_email_template"/>
        <field name="report" ref="account_invoice.report_invoice"/>
    </record>

    <!-- Sale -->
    <data depends="sale" noupdate="1" skiptest="1">
        <record model="electronic.mail.template" id="sale_email_template">
            <field name="name">Venta</field>
            <field name="from_">user@demo_server.com</field>
            <field name="to">${record.invoice_address.email or record.party.get_mechanism('email') or ''}</field>
            <field name="subject">${record.state in ['draft','quotation'] and 'Presupuesto' or 'Pedido'} ${record.reference or record.party.name}</field>
            <field name="model" search="[('model', '=', 'sale.sale')]"/>
            <field name="language">${record.party.lang and record.party.lang.code or 'es_ES'}</field>
            <field name="plain">Estimado Sr./Sra.

${record.invoice_address and record.invoice_address.name or ''}

#if record.state == 'quotation'
Adjuntamos al presente correo electrónico el presupuesto ${record.description or ''} con referéncia ${record.reference}
#end
#if record.state == 'draft'
Adjuntamos al presente correo electrónico el pedido de venta solicitado.
#end
#if record.state != 'draft'
Adjuntamos al presente correo electrónico el pedido de venta con fecha ${str(record.sale_date)[8:]}-${str(record.sale_date)[5:7]}-${str(record.sale_date)[:4]} y número ${record.reference}
#end

#if record.lines
  Ctd Producto
  #for line in record.lines
  ${line.quantity} ${line.description} 
  #end
#end


Atentamente,</field>
            <field name="html">
#if record.state == 'draft'
Presupuesto ${record.description or ''}
#end
#if record.state == 'quotation'
Presupuesto ${record.description or ''} con referencia ${record.reference}
#end
#if record.state not in ['draft', 'quotation']
Pedido de venta '${record.description or ''}
#end
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;table cellspacing="0" cellpadding="0" border="0" width="100%"&gt;
        &lt;tr&gt;
            &lt;td bgcolor="#FFFFFF" align="center"&gt;
                &lt;table width="650px" cellspacing="0" cellpadding="3" class="container"&gt;
                    &lt;tr&gt;&lt;td&gt;
&lt;p&gt;Estimado Sr./Sra. ${record.invoice_address.name or ''},&lt;/p&gt;

#if record.state == 'draft'
&lt;p&gt;Adjuntamos el presupuesto ${record.description or ''} que ha solicitado.&lt;/p&gt;
#end
#if record.state == 'quotation'
&lt;p&gt;Adjuntamos el presupuesto ${record.description or ''} con referencia ${record.reference}.&lt;/p&gt;
#end
#if record.state not in ['draft', 'quotation']
&lt;p&gt;Adjuntamos el pedido de venta ${record.description or ''} con fecha ${str(record.sale_date)[8:]}-${str(record.sale_date)[5:7]}-${str(record.sale_date)[:4]} y referència ${record.reference}.&lt;/p&gt;
#end
                    &lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;
                        &lt;table class="table table-condensed" width="647"&gt;
                        &lt;thead&gt;
                            &lt;tr&gt;
                            &lt;th&gt;Cantidad&lt;/th&gt;
                            &lt;th&gt;Producto&lt;/th&gt;
                            &lt;th&gt;Precio&lt;/th&gt;
                            &lt;th&gt;Total&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody&gt;
#for line in record.lines
#if line.type == 'line'
                        &lt;tr&gt;&lt;td&gt;${line.quantity or ''}&lt;/td&gt;&lt;td&gt;${line.product and line.product.rec_name}&lt;/td&gt;&lt;td style="text-align: right; color:#006699;"&gt;${round(line.unit_price, 2) or ''}&lt;/td&gt;&lt;td style="text-align: right; color:#006699;"&gt;${line.amount or ''}&lt;/td&gt;&lt;/tr&gt;
#end
#end
                        &lt;tr&gt;
                            &lt;td colspan="4" style="text-align: right; color:#006699;"&gt;
                                &lt;hr/&gt;
                                &lt;ul style="list-style: none";&gt;
                                    &lt;li&gt;&lt;strong&gt;Base:&lt;/strong&gt; ${record.untaxed_amount}&lt;/li&gt;
                                    &lt;li&gt;&lt;strong&gt;Impuestos:&lt;/strong&gt; ${record.tax_amount}&lt;/li&gt;
                                    &lt;li&gt;&lt;strong&gt;Total:&lt;/strong&gt; ${record.total_amount}&lt;/li&gt;
                                &lt;/ul&gt;
                            &lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;/tbody&gt;
                        &lt;/table&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td bgcolor="#FFFFFF" align="center"&gt;
                &lt;table width="650px" cellspacing="0" cellpadding="3" class="container"&gt;
                    &lt;tr&gt;
                        &lt;td&gt;
                            &lt;hr&gt;
                            &lt;p&gt;${record.company.party.get_mechanism('email') or ''}&lt;/p&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;</field>
            <field name="engine">genshi</field>
            <field name="signature" eval="True"/>
        </record>
        <record model="electronic.mail.template.ir.action.report" id="sale_email_template_report">
            <field name="template" ref="sale_email_template"/>
            <field name="report" ref="sale.report_sale"/>
        </record>
    </data>
</tryton>
